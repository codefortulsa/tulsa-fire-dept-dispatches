{% spaceless %}<!DOCTYPE html> 
<html>
<head>
    <title>{% block title %}Tulsa Fire Dispatch{% endblock %}</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1"> 


    {% load static from staticfiles %}    
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile.structure-1.2.0.min.css" />
    <link rel="stylesheet" href="{% static "themes/sarah_black2.min.css" %}" />
    <link rel="stylesheet" href="{% static "themes/tfdd_snips.css" %}" />


    <script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
    
</head>
<body>
    <div class="dispatch_page" data-role="page">
            
        <div data-role="header">
            
                <div class="tfdd_logo">
                    <img  src="{% static "img/logo.png" %}" alt="Tulsa Fire Dept. Dispatches" />
                </div>
                <a href="{% url about %}"
                    data-icon="info" 
                    data-transition="flip"
                    class="ui-btn-right">About</a>

                
                
            <div    data-role="navbar" >
                <ul>
                    <li><a href="{% url dispatches %}" 
                        data-transition="none"
                        >Dispatches</a></li>                    
                    {% if user.is_authenticated %}
                    <li><a href="{% url following %}"
                        data-transition="none" 
                        >Following</a></li>
                    <li><a href="{% url settings %}"
                        data-transition="none"
                        >Settings</a>
                    </li>

                    {% else %}
                    <li><a href="{% url login %}"
                        data-transition="none"
                        data-prefetch 
                        >Login</a></li>
                    {% endif %}

                </ul>
            </div><!-- /navbar -->
            
{% if user.is_authenticated %}
        <div class="tfdd_listen" data-role="navbar">
                <div class="cylon_eye">
                    Listening for dispatches
                </div>
        </div>
 {% endif %}  
          
        </div><!--  /header -->


        <div data-role="content">
            <div class='messages'>
                {% comment %}
                {% if user.is_authenticated %}
                    {% if not user.profile.email_verified %}
                    <p>Please verify your email</p>
                    {% endif %}
                    {% if user.profile.phone and not user.profile.phone_verified %}
                    <p>Please verify your phone number</p>
                    {% endif %}
                {% endif %}
                {% endcomment %}
                <ul class="messages">
                {% for message in messages %}
                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                {% endfor %}
                </ul>
            </div>    <!-- End of messages -->
            
            
            
            {% block content %}
            <p> Content goes here </p>
            {% endblock %}

        </div>    <!-- End of content -->
        
    </div><!-- End of page -->

{% if user.is_authenticated %}

<script>
    
    
    function UpdateCheck (){

        $(".dispatch_listview").each(function(index,dispatch_listview){
             $.ajax({
                 url: $(dispatch_listview.children[0]).data("tf-update-url"),
                 success: function(data){
                         $('.tfdd_listen').css("background-color","green");
                         $.mobile.loading( 'show', {
                         	text: 'Incoming Dispatch',
                         	textVisible: true,
                         });
                         setTimeout(function() {
                             $(dispatch_listview).prepend($("li", data)).listview('refresh').trigger( "create" );
                             $.mobile.loading( 'hide');
                             $('.tfdd_listen').css("background-color","red");
                             }, 750);
                 }
             })
          });                   
         };

    setInterval(function() {UpdateCheck(true);}, 4000);

    moveIncr=1
    moveSpeed=20

    function moveEye(i){
        if(i>100){
            moveIncr=-1;        
        }
        if (i<-10){
        moveIncr=1;
        }

        $('.cylon_eye').css({backgroundImage:"-webkit-linear-gradient(left, rgba(0,0,0,0.8) "+i+"%, rgba(0,0,0,0.2) "+(i+5)+"%, rgba(0,0,0,0.8) "+(i+10)+"%)"});

        setTimeout(function(){moveEye(i+moveIncr);},moveSpeed)
    };
    
    setTimeout(function(){moveEye(-10);},moveSpeed);

</script>
{% endif %}

</body>
</html>{% endspaceless %}
